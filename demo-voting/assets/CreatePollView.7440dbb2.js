var $=Object.defineProperty;var A=(s,t,a)=>t in s?$(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var j=(s,t,a)=>(A(s,typeof t!="symbol"?t+"":t,a),a);import{_ as S,o as l,c,a as e,d as G,u as X,b as q,e as Q,f as K,g as ee,r as w,h as te,N as se,i as oe,w as I,v as J,F as R,j as P,k as y,l as x,m as z,A as O,n as ae,p as E,q as le,s as ne,t as ie,x as W,y as re,z as ce}from"./index.139a715d.js";import{S as de}from"./SuccessInfo.8d5aeb3e.js";const pe={},ue={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},he=e("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM17 13H7V11H17V13Z",fill:"#565B61"},null,-1),_e=[he];function fe(s,t){return l(),c("svg",ue,_e)}const me=S(pe,[["render",fe]]),ve={},we={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},be=e("g",{"clip-path":"url(#clip0_56_1176)"},[e("path",{d:"M13 7H11V11H7V13H11V17H13V13H17V11H13V7ZM12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z",fill:"currentColor"})],-1),ye=e("defs",null,[e("clipPath",{id:"clip0_56_1176"},[e("rect",{width:"24",height:"24",fill:"white"})])],-1),ge=[be,ye];function xe(s,t){return l(),c("svg",we,ge)}const Ce=S(ve,[["render",xe]]),M=class{};let C=M;j(C,"JWT_TOKEN","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mb3JtYXRpb24iOnsiaWQiOiI2ZTg3ODViMy05NWJjLTQ2OGMtOTBjMC0wYjk3MzYxMDhhMzYiLCJlbWFpbCI6Im1hdGV2ekBvYXNpc3Byb3RvY29sLm9yZyIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJwaW5fcG9saWN5Ijp7InJlZ2lvbnMiOlt7ImlkIjoiRlJBMSIsImRlc2lyZWRSZXBsaWNhdGlvbkNvdW50IjoxfSx7ImlkIjoiTllDMSIsImRlc2lyZWRSZXBsaWNhdGlvbkNvdW50IjoxfV0sInZlcnNpb24iOjF9LCJtZmFfZW5hYmxlZCI6ZmFsc2UsInN0YXR1cyI6IkFDVElWRSJ9LCJhdXRoZW50aWNhdGlvblR5cGUiOiJzY29wZWRLZXkiLCJzY29wZWRLZXlLZXkiOiJkYTAyNDkwYTI2NjE1Zjk5YjhiZCIsInNjb3BlZEtleVNlY3JldCI6ImU3NTc5ZjI4ZTQ2YjA1OTJlZmI1N2Y4NjRiYzA4ZjAzMmFiZWE0NDliYjFmYzAwZTBkZDUyODU5MjU0ODkwMjEiLCJpYXQiOjE2ODk2OTM4Nzh9.pG2WHK4pJo_jmThcA9GsXzrSfjRFJFooZnzSVqwuPp0"),j(C,"pinBody",async t=>{const a=JSON.stringify({pinataContent:t}),d=await fetch("https://api.pinata.cloud/pinning/pinJSONToIPFS",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${M.JWT_TOKEN}`},body:a}),b=await d.json();if(d.status!==200)throw new Error("failed to pin");const g={ipfsHash:b.IpfsHash};return new Response(JSON.stringify(g),{status:201,headers:{"content-type":"application/json"}})});function Ie(s){return new Promise(function(t,a){setTimeout(a.bind(null,s),5e3)})}async function ke(s,t=()=>{},a=10){let d=Promise.reject();for(let b=0;b<a;b++)d=d.catch(()=>s).then(g=>t(g)).catch(Ie);return d}const n=s=>(re("data-v-6b3000b1"),s=s(),ce(),s),Ve={key:0},Ne=n(()=>e("h2",{class:"capitalize text-white text-2xl font-bold mb-4"},"New pool",-1)),Ze=n(()=>e("p",{class:"text-white text-base mb-20"}," Create your new poll by filling out the fields below. Once created, your poll will be live immediately and responses will start being recorded. ",-1)),je={class:"form-group"},Je=n(()=>e("label",{for:"question",class:"peer-focus:text-primaryDark peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-5"},[W(" Question "),e("span",{class:"text-red-500"},"*")],-1)),Oe={class:"form-group form-group-textarea"},Se=n(()=>e("label",{for:"description",class:"peer-focus:text-primaryDark peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-5"}," Description ",-1)),We={class:"form-group-extended"},Me=n(()=>e("label",{class:"inline-block mb-5"},[W("Answers "),e("span",{class:"text-red-500"},"*")],-1)),Te=["placeholder","onUpdate:modelValue"],De={class:"flex gap-2"},Ye=n(()=>e("span",{class:"leading-6"},"Add answer",-1)),Be={class:"form-group-extended"},Re=n(()=>e("label",{class:"inline-block mb-5"},"Additional options",-1)),Pe={class:"flex pl-4"},ze=n(()=>e("label",{class:"ml-3 text-base text-gray-900",for:"publish-votes"}," Publish individual votes after voting has ended. ",-1)),Ee={key:0},Fe={key:1},Le={key:0,class:"text-red-500 px-3 mt-5 rounded-xl-sm"},Ue=n(()=>e("span",{class:"font-bold"},"Errors:",-1)),He={class:"list-disc px-8"},$e={key:1},Ae=n(()=>e("h3",{class:"text-white text-3xl mb-4"},"Success",-1)),Ge=n(()=>e("p",{class:"text-white text-base"},"Your poll is live.",-1)),Xe=n(()=>e("p",{class:"text-white text-base mb-24"},"Votes will be recorded from now on.",-1)),qe=G({__name:"CreatePollView",setup(s){const t=X(),a=q(),d=Q(),b=K(),g=ee(),h=w([]),k=w(""),V=w(""),p=w(Array.from({length:3},(i,o)=>({key:o,value:""}))),N=w(!1),_=w(!1),Z=w("");let T=3;const F=i=>p.value.splice(i,1),L=()=>{p.value.push({key:T,value:""}),T++};async function U(i){var o;if(!(i.target instanceof HTMLFormElement&&(i.target.checkValidity(),!i.target.reportValidity()))){i.preventDefault();try{h.value.splice(0,h.value.length),_.value=!0,Z.value=await H()}catch(u){h.value.push(`Failed to create poll: ${(o=u.message)!=null?o:JSON.stringify(u)}`),console.error(u)}finally{_.value=!1}}}async function H(){if(h.value.length>0)return"";const i={creator:t.address,name:k.value,description:V.value,choices:p.value.map(v=>v.value),options:{publishVotes:N.value}},o=await C.pinBody(i),u=await o.json();if(o.status!==201)throw new Error(u.error);const f={ipfsHash:u.ipfsHash,numChoices:p.value.length,publishVotes:i.options.publishVotes};let m;(await b).value,(await g).value,console.log("doCreatePoll: Using direct transaction to create proposal");const D=await a.value.createProposal(f);console.log("doCreatePoll: creating proposal tx",D.hash);const Y=await D.wait();if(Y.status!==1)throw new Error("createProposal tx receipt reported failure.");return m=Y.logs[0].data,console.log("doCreatePoll: Proposal ID",m),ke(d.value.callStatic.ballotIsActive(m),v=>{if(!v)throw new Error("Unable to determine the status of proposal.");return v}).then(()=>m.replace("0x","")).catch(v=>{var B;return h.value.push(`Failed to create poll: ${(B=v.message)!=null?B:JSON.stringify(v)}`),""})}return te(async()=>{await t.connect(),await t.switchNetwork(se.FromConfig)}),(i,o)=>{const u=oe("RouterLink");return Z.value?(l(),c("section",$e,[y(de,null,{default:x(()=>[Ae,Ge,Xe,y(u,{to:{name:"poll",params:{id:Z.value}}},{default:x(()=>[y(O,{variant:"secondary"},{default:x(()=>[W("View poll")]),_:1})]),_:1},8,["to"])]),_:1})])):(l(),c("section",Ve,[Ne,Ze,e("form",{onSubmit:U},[e("div",je,[I(e("input",{type:"text",id:"question",class:"peer",placeholder:" ","onUpdate:modelValue":o[0]||(o[0]=r=>k.value=r),required:""},null,512),[[J,k.value]]),Je]),e("div",Oe,[I(e("textarea",{id:"description",class:"peer",placeholder:" ","onUpdate:modelValue":o[1]||(o[1]=r=>V.value=r),rows:"3"},null,512),[[J,V.value]]),Se]),e("div",We,[Me,(l(!0),c(R,null,P(p.value,(r,f)=>(l(),c("div",{class:"relative flex justify-between items-center mb-4 gap-3 px-5",key:r.key},[I(e("input",{class:"focus:outline-none focus:ring-0 pb-2 text-primaryDark",type:"text",id:"name",placeholder:`${f+1}. Answer`,"onUpdate:modelValue":m=>p.value[f].value=m,required:""},null,8,Te),[[J,p.value[f].value]]),p.value.length>2?(l(),le(me,{key:0,class:ne(["cursor-pointer absolute right-5 bottom-2",{"cursor-default":_.value}]),disabled:_.value,"data-ix":f,onClick:z(m=>F(f),["prevent"])},null,8,["class","disabled","data-ix","onClick"])):E("",!0)]))),128)),y(O,{class:"ml-5",size:"small",variant:"tertiary",disabled:_.value,onClick:z(L,["prevent"])},{default:x(()=>[e("span",De,[y(Ce),Ye])]),_:1},8,["disabled","onClick"])]),e("div",Be,[Re,e("div",Pe,[I(e("input",{id:"publish-votes",class:"w-5 h-5 border-2 border-gray-500",type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=r=>N.value=r)},null,512),[[ae,N.value]]),ze])]),y(O,{type:"submit",variant:"primary",disabled:_.value},{default:x(()=>[_.value?(l(),c("span",Ee,"Creating\u2026")):(l(),c("span",Fe,"Create Poll"))]),_:1},8,["disabled"]),h.value.length>0?(l(),c("div",Le,[Ue,e("ul",He,[(l(!0),c(R,null,P(h.value,r=>(l(),c("li",{key:r},ie(r),1))),128))])])):E("",!0)],32)]))}}});const tt=S(qe,[["__scopeId","data-v-6b3000b1"]]);export{tt as default};
//# sourceMappingURL=CreatePollView.7440dbb2.js.map
