import{d as N,o as t,c as a,z as K,q as R,_ as B,a as e,p as x,k as h,B as j,C as Q,b as W,e as X,u as ee,f as te,g as se,r as _,D as ae,E as oe,G as Z,H as ne,h as ie,t as k,j as V,A as P,n as w,F as le,i as ce,N as F,I as re,s as A,J as de,x as ue,y as pe}from"./index.dae7de47.js";import{S as ve}from"./SuccessInfo.e2857884.js";const _e=N({__name:"AppBadge",props:{variant:{}},setup(r){return(g,d)=>(t(),a("span",{class:R(["badge",{"badge-active":g.variant==="active","badge-closed":g.variant==="closed"}])},[K(g.$slots,"default",{},void 0,!0)],2))}});const he=B(_e,[["__scopeId","data-v-02503d7b"]]),fe={},we={width:"24",height:"25",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ge=e("g",{"clip-path":"url(#clip0_56_971)"},[e("path",{d:"M12 7.1333C9.24 7.1333 7 9.3733 7 12.1333C7 14.8933 9.24 17.1333 12 17.1333C14.76 17.1333 17 14.8933 17 12.1333C17 9.3733 14.76 7.1333 12 7.1333ZM12 2.1333C6.48 2.1333 2 6.6133 2 12.1333C2 17.6533 6.48 22.1333 12 22.1333C17.52 22.1333 22 17.6533 22 12.1333C22 6.6133 17.52 2.1333 12 2.1333ZM12 20.1333C7.58 20.1333 4 16.5533 4 12.1333C4 7.7133 7.58 4.1333 12 4.1333C16.42 4.1333 20 7.7133 20 12.1333C20 16.5533 16.42 20.1333 12 20.1333Z",fill:"currentColor"})],-1),me=e("defs",null,[e("clipPath",{id:"clip0_56_971"},[e("rect",{width:"24",height:"24",fill:"white",transform:"translate(0 0.133301)"})])],-1),xe=[ge,me];function ye(r,g){return t(),a("svg",we,xe)}const Ce=B(fe,[["render",ye]]),be={},ke={width:"24",height:"25",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ve=e("g",{"clip-path":"url(#clip0_56_273)"},[e("path",{d:"M12 2.1333C6.48 2.1333 2 6.6133 2 12.1333C2 17.6533 6.48 22.1333 12 22.1333C17.52 22.1333 22 17.6533 22 12.1333C22 6.6133 17.52 2.1333 12 2.1333ZM12 20.1333C7.58 20.1333 4 16.5533 4 12.1333C4 7.7133 7.58 4.1333 12 4.1333C16.42 4.1333 20 7.7133 20 12.1333C20 16.5533 16.42 20.1333 12 20.1333Z",fill:"currentColor"})],-1),Pe=e("defs",null,[e("clipPath",{id:"clip0_56_273"},[e("rect",{width:"24",height:"24",fill:"white",transform:"translate(0 0.133301)"})])],-1),$e=[Ve,Pe];function Se(r,g){return t(),a("svg",ke,$e)}const Ae=B(be,[["render",Se]]),Be=e("rect",{x:"5",y:"10",rx:"3",ry:"3",width:"361",height:"28"},null,-1),Ie=e("rect",{x:"5",y:"26",rx:"3",ry:"3",width:"52",height:"6"},null,-1),Ne=e("rect",{x:"5",y:"61",rx:"3",ry:"3",width:"410",height:"16"},null,-1),De=e("rect",{x:"680",y:"10",rx:"0",ry:"0",width:"80",height:"19"},null,-1),Ee=N({__name:"PollDetailsLoader",setup(r){return(g,d)=>(t(),x(j(Q),{viewBox:"0 0 768 124",speed:2,primaryColor:"white",secondaryColor:"#e3e3e3"},{default:h(()=>[Be,Ie,Ne,De]),_:1}))}}),D=r=>(ue("data-v-74069cfb"),r=r(),pe(),r),Ge={key:0},Le={key:0},Me={class:"flex justify-between items-center mb-4"},Te={class:"capitalize text-white text-2xl font-bold"},Ze={class:"text-white text-base mb-20"},Fe={key:0,class:"flex justify-end mb-6"},Re={key:1,class:"text-white text-base mb-10"},je={key:0},Oe={class:"flex gap-2"},Ue={class:"leading-6"},qe={key:1,class:"text-white text-base mt-10"},ze={key:0},He={key:1},Ye={key:3,class:"error mt-2 text-center"},Je={class:"font-bold"},Ke={key:1},Qe=D(()=>e("h3",{class:"text-white text-3xl mb-4"},"Thank you",-1)),We=D(()=>e("p",{class:"text-white text-base mb-4"},"Your vote has been recorded.",-1)),Xe={class:"flex gap-2"},et=D(()=>e("p",{class:"text-white text-base mb-24"},"Your vote will be published after voting has ended.",-1)),tt=N({__name:"PollView",props:{id:{}},setup(r){const d=`0x${r.id}`,$=W(),E=X(),n=ee(),O=te(),U=se(),S=_(""),y=_(!1),G=_(!1),s=_(),m=_(void 0),u=_(),I=_(void 0);let L=_(!1),M=_(!1);(async()=>{const[p,i,l]=await E.value.callStatic.proposals(d),c={id:d,active:p,topChoice:l,params:i},b=await(await fetch(`https://w3s.link/ipfs/${i.ipfsHash}`)).json();s.value={proposal:c,ipfsParams:b},c.active||(u.value=m.value=c.topChoice);const f=await ae(),v=n.signer?await n.signer.getAddress():oe;L.value=await f.value.callStatic.canManagePoll($.value.address,d,v),M.value=await f.value.callStatic.canVoteOnPoll($.value.address,d,v)})();const q=Z(()=>!n.address||m.value!==void 0||u.value===void 0||I.value!==void 0?!1:M.value!=!1),z=Z(()=>m.value!==void 0?!1:n.address===void 0?!0:I.value===void 0);async function H(){if(await n.connect(),await n.switchNetwork(F.FromConfig),(await(await $.value.closeProposal(d)).wait()).status!=1)throw new Error("close ballot tx failed")}async function T(p){var i;p.preventDefault();try{S.value="",y.value=!0,await Y(),G.value=!0}catch(l){S.value=(i=l.reason)!=null?i:l.message}finally{y.value=!1}}async function Y(){if(await n.connect(),u.value===void 0)throw new Error("no choice selected");const p=u.value,i=(await O).value,l=(await U).value;if(i&&l){if(console.log("doVote: using gasless voting"),!n.signer)throw new Error("No signer!");const c={voter:await i.signer.getAddress(),proposalId:d,choiceId:p},C=await n.signer._signTypedData({name:"DAOv1.GaslessVoting",version:"1",chainId:"0x5aff",verifyingContract:i.address},{VotingRequest:[{name:"voter",type:"address"},{name:"proposalId",type:"bytes32"},{name:"choiceId",type:"uint256"}]},c),b=re(C),f=await E.value.provider.getGasPrice();console.log("doVote.gasless: constructing tx","gasPrice",f);const v=await l.makeVoteTransaction(f,c,b);let o=await n.unwrappedProvider.sendTransaction(v);if(console.log("doVote.gasless: waiting for tx",o.hash),(await l.provider.waitForTransaction(o.hash)).status!=1)throw new Error("cast vote tx failed");console.log("doVote.gasless: success")}else if(console.log("doVote: casting vote using normal tx"),await n.switchNetwork(F.FromConfig),(await(await $.value.castVote(d,p)).wait()).status!=1)throw new Error("cast vote tx failed");I.value=p}return ne(()=>{n.connect()}),(p,i)=>{var c,C,b,f;const l=ie("RouterLink");return G.value?(t(),a("section",Ke,[V(ve,null,{default:h(()=>{var v,o;return[Qe,We,((o=(v=s.value)==null?void 0:v.ipfsParams)==null?void 0:o.choices)&&u.value?(t(),x(P,{key:0,class:"mb-4 pointer-events-none cursor-not-allowed w-full voted",variant:"choice"},{default:h(()=>[e("span",Xe,[V(de,{class:"w-7"}),A(" "+k(s.value.ipfsParams.choices[u.value]),1)])]),_:1})):w("",!0),et,V(l,{to:"/"},{default:h(()=>[V(P,{variant:"secondary"},{default:h(()=>[A("Go to overview")]),_:1})]),_:1})]}),_:1})])):(t(),a("section",Ge,[s.value?(t(),a("div",Le,[e("div",Me,[e("h2",Te,k(s.value.ipfsParams.name),1),V(he,{variant:s.value.proposal.active?"active":"closed"},{default:h(()=>[A(k(s.value.proposal.active?"Active":"Closed"),1)]),_:1},8,["variant"])]),e("p",Ze,k(s.value.ipfsParams.description),1),s.value.proposal.active&&j(L)?(t(),a("div",Fe,[V(P,{variant:"secondary",onClick:H},{default:h(()=>[A("Close poll")]),_:1})])):w("",!0),s.value.proposal.active?(t(),a("p",Re," Please choose your anwer below: ")):w("",!0),e("form",{onSubmit:T},[(c=s.value)!=null&&c.ipfsParams.choices?(t(),a("div",je,[(t(!0),a(le,null,ce(s.value.ipfsParams.choices,(v,o)=>(t(),x(P,{key:o,class:R([{selected:u.value===o||o===m.value,"pointer-events-none":y.value||!s.value.proposal.active},"choice-btn mb-2 w-full"]),variant:"choice",onClick:J=>u.value=o,disabled:!z.value&&m.value!==void 0&&o!==m.value},{default:h(()=>[e("span",Oe,[u.value===o||o===m.value?(t(),x(Ce,{key:0})):(t(),x(Ae,{key:1})),e("span",Ue,k(v),1)])]),_:2},1032,["class","onClick","disabled"]))),128))])):w("",!0),(C=s.value)!=null&&C.ipfsParams.options.publishVotes?(t(),a("p",qe," Votes will be made public after voting has ended. ")):w("",!0),(f=(b=s.value)==null?void 0:b.proposal)!=null&&f.active?(t(),x(P,{key:2,type:"submit",variant:"primary",class:"mt-14",disabled:!q.value||y.value,onClick:T},{default:h(()=>[y.value?(t(),a("span",ze,"Submitting Vote\u2026")):y.value?w("",!0):(t(),a("span",He,"Submit vote"))]),_:1},8,["disabled"])):w("",!0),S.value?(t(),a("p",Ye,[e("span",Je,k(S.value),1)])):w("",!0)],32)])):(t(),x(Ee,{key:1}))]))}}});const ot=B(tt,[["__scopeId","data-v-74069cfb"]]);export{ot as default};
//# sourceMappingURL=PollView.5871fbe4.js.map
