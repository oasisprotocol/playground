import{_ as Z,o as a,c as i,a as e,d as H,u as U,b as $,e as E,f as G,g as X,r as u,h as q,w as b,v as k,F as M,i as W,j as v,k as m,l as Y,A as V,m as Q,n as D,N as K,p as ee,q as te,t as se,s as N,x as oe,y as ae}from"./index.89eded14.js";import{S as le}from"./SuccessInfo.5e6a9d5b.js";const ne={},ie={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},re=e("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM17 13H7V11H17V13Z",fill:"#565B61"},null,-1),ce=[re];function de(h,f){return a(),i("svg",ie,ce)}const pe=Z(ne,[["render",de]]),ue={},he={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},_e=e("g",{"clip-path":"url(#clip0_56_1176)"},[e("path",{d:"M13 7H11V11H7V13H11V17H13V13H17V11H13V7ZM12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z",fill:"currentColor"})],-1),ve=e("defs",null,[e("clipPath",{id:"clip0_56_1176"},[e("rect",{width:"24",height:"24",fill:"white"})])],-1),fe=[_e,ve];function me(h,f){return a(),i("svg",he,fe)}const we=Z(ue,[["render",me]]),l=h=>(oe("data-v-19e8f4cb"),h=h(),ae(),h),be={key:0},ye=l(()=>e("h2",{class:"capitalize text-white text-2xl font-bold mb-4"},"New pool",-1)),xe=l(()=>e("p",{class:"text-white text-base mb-20"}," Create your new poll by filling out the fields below. Once created, your poll will be live immediately and responses will start being recorded. ",-1)),ge={class:"form-group"},Ce=l(()=>e("label",{for:"question",class:"peer-focus:text-primaryDark peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-5"},[N(" Question "),e("span",{class:"text-red-500"},"*")],-1)),Ie={class:"form-group form-group-textarea"},ke=l(()=>e("label",{for:"description",class:"peer-focus:text-primaryDark peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-5"}," Description ",-1)),Ve={class:"form-group-extended"},Ze=l(()=>e("label",{class:"inline-block mb-5"},[N("Answers "),e("span",{class:"text-red-500"},"*")],-1)),Ne=["placeholder","onUpdate:modelValue"],je={class:"flex gap-2"},Je=l(()=>e("span",{class:"leading-6"},"Add answer",-1)),Se={class:"form-group-extended"},Oe=l(()=>e("label",{class:"inline-block mb-5"},"Additional options",-1)),Me={class:"flex pl-4"},We=l(()=>e("label",{class:"ml-3 text-base text-gray-900",for:"publish-votes"}," Publish individual votes after voting has ended. ",-1)),Ye={key:0},De={key:1},Pe={key:0,class:"text-red-500 px-3 mt-5 rounded-xl-sm"},Re=l(()=>e("span",{class:"font-bold"},"Errors:",-1)),Be={class:"list-disc px-8"},Te={key:1},Ae=l(()=>e("h3",{class:"text-white text-3xl mb-4"},"Success",-1)),Le=l(()=>e("p",{class:"text-white text-base"},"Your poll is live.",-1)),ze=l(()=>e("p",{class:"text-white text-base mb-24"},"Votes will be recorded from now on.",-1)),Fe=H({__name:"CreatePollView",setup(h){const f=U(),P=$(),R=E(),B=G(),T=X(),A=async(o,t)=>{const n=await fetch("https://api.pinata.cloud/pinning/pinJSONToIPFS",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${o}`},body:JSON.stringify({pinataContent:t})}),s=await n.json();if(n.status!==200)throw new Error("failed to pin");const r={ipfsHash:s.IpfsHash};return new Response(JSON.stringify(r),{status:201,headers:{"content-type":"application/json"}})},_=u([]),y=u(""),x=u(""),c=u([]),g=u(!1),p=u(!1),C=u("");let j=0;const L=o=>c.value.splice(o,1),w=()=>{c.value.push({key:j,value:""}),j++};w(),w(),w();async function z(o){var t;if(!(o.target instanceof HTMLFormElement&&(o.target.checkValidity(),!o.target.reportValidity()))){o.preventDefault();try{_.value.splice(0,_.value.length),p.value=!0,C.value=await F()}catch(n){_.value.push(`Failed to create poll: ${(t=n.message)!=null?t:JSON.stringify(n)}`),console.error(n)}finally{p.value=!1}}}async function F(){if(await f.connect(),await f.switchNetwork(K.FromConfig),_.value.length>0)return"";const o={creator:f.address,name:y.value,description:x.value,choices:c.value.map(I=>I.value),options:{publishVotes:g.value}},t=await A("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mb3JtYXRpb24iOnsiaWQiOiI2ZTg3ODViMy05NWJjLTQ2OGMtOTBjMC0wYjk3MzYxMDhhMzYiLCJlbWFpbCI6Im1hdGV2ekBvYXNpc3Byb3RvY29sLm9yZyIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJwaW5fcG9saWN5Ijp7InJlZ2lvbnMiOlt7ImlkIjoiRlJBMSIsImRlc2lyZWRSZXBsaWNhdGlvbkNvdW50IjoxfSx7ImlkIjoiTllDMSIsImRlc2lyZWRSZXBsaWNhdGlvbkNvdW50IjoxfV0sInZlcnNpb24iOjF9LCJtZmFfZW5hYmxlZCI6ZmFsc2UsInN0YXR1cyI6IkFDVElWRSJ9LCJhdXRoZW50aWNhdGlvblR5cGUiOiJzY29wZWRLZXkiLCJzY29wZWRLZXlLZXkiOiJkYTAyNDkwYTI2NjE1Zjk5YjhiZCIsInNjb3BlZEtleVNlY3JldCI6ImU3NTc5ZjI4ZTQ2YjA1OTJlZmI1N2Y4NjRiYzA4ZjAzMmFiZWE0NDliYjFmYzAwZTBkZDUyODU5MjU0ODkwMjEiLCJpYXQiOjE2ODk2OTM4Nzh9.pG2WHK4pJo_jmThcA9GsXzrSfjRFJFooZnzSVqwuPp0",o),n=await t.json();if(t.status!==201)throw new Error(n.error);const r={ipfsHash:n.ipfsHash,numChoices:c.value.length,publishVotes:o.options.publishVotes};let d;(await B).value,(await T).value,console.log("doCreatePoll: Using direct transaction to create proposal");const J=await P.value.createProposal(r);console.log("doCreatePoll: creating proposal tx",J.hash);const S=await J.wait();if(S.status!==1)throw new Error("createProposal tx receipt reported failure.");d=S.logs[0].data,console.log("doCreatePoll: Proposal ID",d);let O=!1;for(;!O;)console.log("doCreatePoll: checking if ballot has been created on Sapphire",d),O=await R.value.callStatic.ballotIsActive(d),await new Promise(I=>setTimeout(I,1e3));return d.replace("0x","")}return(o,t)=>{const n=q("RouterLink");return C.value?(a(),i("section",Te,[v(le,null,{default:m(()=>[Ae,Le,ze,v(n,{to:{name:"poll",params:{id:C.value}}},{default:m(()=>[v(V,{variant:"secondary"},{default:m(()=>[N("View poll")]),_:1})]),_:1},8,["to"])]),_:1})])):(a(),i("section",be,[ye,xe,e("form",{onSubmit:z},[e("div",ge,[b(e("input",{type:"text",id:"question",class:"peer",placeholder:" ","onUpdate:modelValue":t[0]||(t[0]=s=>y.value=s),required:""},null,512),[[k,y.value]]),Ce]),e("div",Ie,[b(e("textarea",{id:"description",class:"peer",placeholder:" ","onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s),rows:"3"},null,512),[[k,x.value]]),ke]),e("div",Ve,[Ze,(a(!0),i(M,null,W(c.value,(s,r)=>(a(),i("div",{class:"relative flex justify-between items-center mb-4 gap-3 px-5",key:s.key},[b(e("input",{class:"focus:outline-none focus:ring-0 pb-2 text-primaryDark",type:"text",id:"name",placeholder:`${r+1}. Answer`,"onUpdate:modelValue":d=>c.value[r].value=d,required:""},null,8,Ne),[[k,c.value[r].value]]),c.value.length>2?(a(),ee(pe,{key:0,class:te(["cursor-pointer absolute right-5 bottom-2",{"cursor-default":p.value}]),disabled:p.value,"data-ix":r,onClick:Y(d=>L(r),["prevent"])},null,8,["class","disabled","data-ix","onClick"])):D("",!0)]))),128)),v(V,{class:"ml-5",size:"small",variant:"tertiary",disabled:p.value,onClick:Y(w,["prevent"])},{default:m(()=>[e("span",je,[v(we),Je])]),_:1},8,["disabled","onClick"])]),e("div",Se,[Oe,e("div",Me,[b(e("input",{id:"publish-votes",class:"w-5 h-5 border-2 border-gray-500",type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=s=>g.value=s)},null,512),[[Q,g.value]]),We])]),v(V,{type:"submit",variant:"primary",disabled:p.value},{default:m(()=>[p.value?(a(),i("span",Ye,"Creating\u2026")):(a(),i("span",De,"Create Poll"))]),_:1},8,["disabled"]),_.value.length>0?(a(),i("div",Pe,[Re,e("ul",Be,[(a(!0),i(M,null,W(_.value,s=>(a(),i("li",{key:s},se(s),1))),128))])])):D("",!0)],32)]))}}});const $e=Z(Fe,[["__scopeId","data-v-19e8f4cb"]]);export{$e as default};
//# sourceMappingURL=CreatePollView.1a05ec40.js.map
