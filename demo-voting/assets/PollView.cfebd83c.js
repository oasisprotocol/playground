import{d as G,o as t,c as a,z as W,q as O,_ as B,a as e,p as y,k as l,B as U,C as X,b as ee,e as te,u as se,f as ae,g as oe,r as d,D as ne,E as ie,G as F,H as le,h as ce,t as V,j as f,A as P,n as w,F as re,i as de,N as R,I as ue,s as $,J as pe,x as ve,y as _e}from"./index.89eded14.js";import{S as j}from"./SuccessInfo.5e6a9d5b.js";const he=G({__name:"AppBadge",props:{variant:{}},setup(u){return(m,p)=>(t(),a("span",{class:O(["badge",{"badge-active":m.variant==="active","badge-closed":m.variant==="closed"}])},[W(m.$slots,"default",{},void 0,!0)],2))}});const fe=B(he,[["__scopeId","data-v-02503d7b"]]),we={},ge={width:"24",height:"25",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg"},me=e("g",{"clip-path":"url(#clip0_56_971)"},[e("path",{d:"M12 7.1333C9.24 7.1333 7 9.3733 7 12.1333C7 14.8933 9.24 17.1333 12 17.1333C14.76 17.1333 17 14.8933 17 12.1333C17 9.3733 14.76 7.1333 12 7.1333ZM12 2.1333C6.48 2.1333 2 6.6133 2 12.1333C2 17.6533 6.48 22.1333 12 22.1333C17.52 22.1333 22 17.6533 22 12.1333C22 6.6133 17.52 2.1333 12 2.1333ZM12 20.1333C7.58 20.1333 4 16.5533 4 12.1333C4 7.7133 7.58 4.1333 12 4.1333C16.42 4.1333 20 7.7133 20 12.1333C20 16.5533 16.42 20.1333 12 20.1333Z",fill:"currentColor"})],-1),xe=e("defs",null,[e("clipPath",{id:"clip0_56_971"},[e("rect",{width:"24",height:"24",fill:"white",transform:"translate(0 0.133301)"})])],-1),ye=[me,xe];function Ce(u,m){return t(),a("svg",ge,ye)}const be=B(we,[["render",Ce]]),ke={},Ve={width:"24",height:"25",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Pe=e("g",{"clip-path":"url(#clip0_56_273)"},[e("path",{d:"M12 2.1333C6.48 2.1333 2 6.6133 2 12.1333C2 17.6533 6.48 22.1333 12 22.1333C17.52 22.1333 22 17.6533 22 12.1333C22 6.6133 17.52 2.1333 12 2.1333ZM12 20.1333C7.58 20.1333 4 16.5533 4 12.1333C4 7.7133 7.58 4.1333 12 4.1333C16.42 4.1333 20 7.7133 20 12.1333C20 16.5533 16.42 20.1333 12 20.1333Z",fill:"currentColor"})],-1),$e=e("defs",null,[e("clipPath",{id:"clip0_56_273"},[e("rect",{width:"24",height:"24",fill:"white",transform:"translate(0 0.133301)"})])],-1),Se=[Pe,$e];function Ae(u,m){return t(),a("svg",Ve,Se)}const Be=B(ke,[["render",Ae]]),Ie=e("rect",{x:"5",y:"10",rx:"3",ry:"3",width:"361",height:"28"},null,-1),Ne=e("rect",{x:"5",y:"26",rx:"3",ry:"3",width:"52",height:"6"},null,-1),De=e("rect",{x:"5",y:"61",rx:"3",ry:"3",width:"410",height:"16"},null,-1),Ee=e("rect",{x:"680",y:"10",rx:"0",ry:"0",width:"80",height:"19"},null,-1),Ge=G({__name:"PollDetailsLoader",setup(u){return(m,p)=>(t(),y(U(X),{viewBox:"0 0 768 124",speed:2,primaryColor:"white",secondaryColor:"#e3e3e3"},{default:l(()=>[Ie,Ne,De,Ee]),_:1}))}}),I=u=>(ve("data-v-c7c0f303"),u=u(),_e(),u),Le={key:0},Me={key:0},Te={class:"flex justify-between items-center mb-4"},Ze={class:"capitalize text-white text-2xl font-bold"},Fe={class:"text-white text-base mb-20"},Re={key:0,class:"flex justify-end mb-6"},je={key:1,class:"text-white text-base mb-10"},Oe={key:0},Ue={class:"flex gap-2"},qe={class:"leading-6"},ze={key:1,class:"text-white text-base mt-10"},Ye={key:0},He={key:1},Je={key:3,class:"error mt-2 text-center"},Ke={class:"font-bold"},Qe={key:1},We=I(()=>e("h3",{class:"text-white text-3xl mb-4"},"Thank you",-1)),Xe=I(()=>e("p",{class:"text-white text-center text-base mb-4"},"Your vote has been recorded.",-1)),et={class:"flex gap-2"},tt=I(()=>e("p",{class:"text-white text-center text-base mb-24"},"Your vote will be published after voting has ended.",-1)),st={key:2},at=I(()=>e("p",{class:"text-white text-base mb-4"},"Your poll has been closed.",-1)),ot=G({__name:"PollView",props:{id:{}},setup(u){const p=`0x${u.id}`,S=ee(),L=te(),n=se(),q=ae(),z=oe(),A=d(""),C=d(!1),N=d(!1),D=d(!1),s=d(),x=d(void 0),v=d(),E=d(void 0);let M=d(!1),T=d(!1);(async()=>{const[_,i,c]=await L.value.callStatic.proposals(p),r={id:p,active:_,topChoice:c,params:i},k=await(await fetch(`https://w3s.link/ipfs/${i.ipfsHash}`)).json();s.value={proposal:r,ipfsParams:k},r.active||(v.value=x.value=r.topChoice);const g=await ne(),h=n.signer?await n.signer.getAddress():ie;M.value=await g.value.callStatic.canManagePoll(S.value.address,p,h),T.value=await g.value.callStatic.canVoteOnPoll(S.value.address,p,h)})();const Y=F(()=>!n.address||x.value!==void 0||v.value===void 0||E.value!==void 0?!1:T.value!=!1),H=F(()=>x.value!==void 0?!1:n.address===void 0?!0:E.value===void 0);async function J(){if(await n.connect(),await n.switchNetwork(R.FromConfig),(await(await S.value.closeProposal(p)).wait()).status!=1)throw new Error("close ballot tx failed");D.value=!0}async function Z(_){var i;_.preventDefault();try{A.value="",C.value=!0,await K(),N.value=!0}catch(c){A.value=(i=c.reason)!=null?i:c.message}finally{C.value=!1}}async function K(){if(await n.connect(),v.value===void 0)throw new Error("no choice selected");const _=v.value,i=(await q).value,c=(await z).value;if(i&&c){if(console.log("doVote: using gasless voting"),!n.signer)throw new Error("No signer!");const r={voter:await i.signer.getAddress(),proposalId:p,choiceId:_},b=await n.signer._signTypedData({name:"DAOv1.GaslessVoting",version:"1",chainId:"0x5aff",verifyingContract:i.address},{VotingRequest:[{name:"voter",type:"address"},{name:"proposalId",type:"bytes32"},{name:"choiceId",type:"uint256"}]},r),k=ue(b),g=await L.value.provider.getGasPrice();console.log("doVote.gasless: constructing tx","gasPrice",g);const h=await i.makeVoteTransaction(g,r,k);let o=await n.unwrappedProvider.sendTransaction(h);if(console.log("doVote.gasless: waiting for tx",o.hash),(await c.provider.waitForTransaction(o.hash)).status!=1)throw new Error("cast vote tx failed");console.log("doVote.gasless: success")}else if(console.log("doVote: casting vote using normal tx"),await n.switchNetwork(R.FromConfig),(await(await S.value.castVote(p,_)).wait()).status!=1)throw new Error("cast vote tx failed");E.value=_}return le(()=>{n.connect()}),(_,i)=>{var r,b,k,g;const c=ce("RouterLink");return!N.value&&!D.value?(t(),a("section",Le,[s.value?(t(),a("div",Me,[e("div",Te,[e("h2",Ze,V(s.value.ipfsParams.name),1),f(fe,{variant:s.value.proposal.active?"active":"closed"},{default:l(()=>[$(V(s.value.proposal.active?"Active":"Closed"),1)]),_:1},8,["variant"])]),e("p",Fe,V(s.value.ipfsParams.description),1),s.value.proposal.active&&U(M)?(t(),a("div",Re,[f(P,{variant:"secondary",onClick:J},{default:l(()=>[$("Close poll")]),_:1})])):w("",!0),s.value.proposal.active?(t(),a("p",je," Please choose your anwer below: ")):w("",!0),e("form",{onSubmit:Z},[(r=s.value)!=null&&r.ipfsParams.choices?(t(),a("div",Oe,[(t(!0),a(re,null,de(s.value.ipfsParams.choices,(h,o)=>(t(),y(P,{key:o,class:O([{selected:v.value===o||o===x.value,"pointer-events-none":C.value||!s.value.proposal.active},"choice-btn mb-2 w-full"]),variant:"choice",onClick:Q=>v.value=o,disabled:!H.value&&x.value!==void 0&&o!==x.value},{default:l(()=>[e("span",Ue,[v.value===o||o===x.value?(t(),y(be,{key:0})):(t(),y(Be,{key:1})),e("span",qe,V(h),1)])]),_:2},1032,["class","onClick","disabled"]))),128))])):w("",!0),(b=s.value)!=null&&b.ipfsParams.options.publishVotes?(t(),a("p",ze," Votes will be made public after voting has ended. ")):w("",!0),(g=(k=s.value)==null?void 0:k.proposal)!=null&&g.active?(t(),y(P,{key:2,type:"submit",variant:"primary",class:"mt-14",disabled:!Y.value||C.value,onClick:Z},{default:l(()=>[C.value?(t(),a("span",Ye,"Submitting Vote\u2026")):C.value?w("",!0):(t(),a("span",He,"Submit vote"))]),_:1},8,["disabled"])):w("",!0),A.value?(t(),a("p",Je,[e("span",Ke,V(A.value),1)])):w("",!0)],32)])):(t(),y(Ge,{key:1}))])):N.value?(t(),a("section",Qe,[f(j,null,{default:l(()=>{var h,o;return[We,Xe,((o=(h=s.value)==null?void 0:h.ipfsParams)==null?void 0:o.choices)&&v.value?(t(),y(P,{key:0,class:"mb-4 pointer-events-none cursor-not-allowed w-full voted",variant:"choice"},{default:l(()=>[e("span",et,[f(pe,{class:"w-7"}),$(" "+V(s.value.ipfsParams.choices[v.value]),1)])]),_:1})):w("",!0),tt,f(c,{to:"/"},{default:l(()=>[f(P,{variant:"secondary"},{default:l(()=>[$("Go to overview")]),_:1})]),_:1})]}),_:1})])):D.value?(t(),a("section",st,[f(j,null,{default:l(()=>[at,f(c,{to:"/"},{default:l(()=>[f(P,{variant:"secondary"},{default:l(()=>[$("Go to overview")]),_:1})]),_:1})]),_:1})])):w("",!0)}}});const lt=B(ot,[["__scopeId","data-v-c7c0f303"]]);export{lt as default};
//# sourceMappingURL=PollView.cfebd83c.js.map
