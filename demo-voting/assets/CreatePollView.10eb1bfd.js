import{_ as N,o as a,c as i,a as e,d as $,u as E,b as G,e as U,f as X,g as F,r as u,h as Q,w as b,v as k,F as D,i as W,j as v,k as f,l as Y,A as V,m as q,n as J,N as K,p as ee,q as te,t as se,s as Z,x as oe,y as ae}from"./index.37d64b81.js";import{S as le}from"./SuccessInfo.2c12e0f9.js";const ne={},ie={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},re=e("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM17 13H7V11H17V13Z",fill:"#565B61"},null,-1),ce=[re];function de(h,m){return a(),i("svg",ie,ce)}const pe=N(ne,[["render",de]]),ue={},he={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},_e=e("g",{"clip-path":"url(#clip0_56_1176)"},[e("path",{d:"M13 7H11V11H7V13H11V17H13V13H17V11H13V7ZM12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z",fill:"currentColor"})],-1),ve=e("defs",null,[e("clipPath",{id:"clip0_56_1176"},[e("rect",{width:"24",height:"24",fill:"white"})])],-1),me=[_e,ve];function fe(h,m){return a(),i("svg",he,me)}const we=N(ue,[["render",fe]]),l=h=>(oe("data-v-44ab7cc5"),h=h(),ae(),h),be={key:0},ye=l(()=>e("h2",{class:"capitalize text-white text-2xl font-bold mb-4"},"New pool",-1)),xe=l(()=>e("p",{class:"text-white text-base mb-20"}," Create your new poll by filling out the fields below. Once created, your poll will be live immediately and responses will start being recorded. ",-1)),ge={class:"form-group"},Ie=l(()=>e("label",{for:"question",class:"peer-focus:text-primaryDark peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-5"},[Z(" Question "),e("span",{class:"text-red-500"},"*")],-1)),Ce={class:"form-group"},ke=l(()=>e("label",{for:"description",class:"peer-focus:text-primaryDark peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-5"}," Description ",-1)),Ve={class:"form-group-answers"},Ne=l(()=>e("label",{class:"inline-block mb-5"},[Z("Answers "),e("span",{class:"text-red-500"},"*")],-1)),Ze=["placeholder","onUpdate:modelValue"],je={class:"flex gap-2"},Me=l(()=>e("span",{class:"leading-6"},"Add answer",-1)),Oe={class:"form-group-answers"},Se=l(()=>e("label",{class:"inline-block mb-5"},"Additional options",-1)),De={class:"flex pl-4"},We=l(()=>e("label",{class:"ml-3 text-base text-gray-900",for:"publish-votes"}," Publish individual votes after voting has ended. ",-1)),Ye={key:0},Je={key:1},Pe={key:0,class:"text-red-500 px-3 mt-5 rounded-xl-sm"},Be=l(()=>e("span",{class:"font-bold"},"Errors:",-1)),Re={class:"list-disc px-8"},Te={key:1},ze=l(()=>e("h3",{class:"text-white text-3xl mb-4"},"Success",-1)),Le=l(()=>e("p",{class:"text-white text-base"},"Your poll is live.",-1)),He=l(()=>e("p",{class:"text-white text-base mb-24"},"Votes will be recorded from now on.",-1)),Ae=$({__name:"CreatePollView",setup(h){const m=E(),P=G(),B=U(),R=X(),T=F(),z=async(o,t)=>{const n=await fetch("https://api.pinata.cloud/pinning/pinJSONToIPFS",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${o}`},body:JSON.stringify({pinataContent:t})}),s=await n.json();if(n.status!==200)throw new Error("failed to pin");const r={ipfsHash:s.IpfsHash};return new Response(JSON.stringify(r),{status:201,headers:{"content-type":"application/json"}})},_=u([]),y=u(""),x=u(""),c=u([]),g=u(!1),p=u(!1),I=u("");let j=0;const L=o=>c.value.splice(o,1),w=()=>{c.value.push({key:j,value:""}),j++};w(),w(),w();async function H(o){var t;if(!(o.target instanceof HTMLFormElement&&(o.target.checkValidity(),!o.target.reportValidity()))){o.preventDefault();try{_.value.splice(0,_.value.length),p.value=!0,I.value=await A()}catch(n){_.value.push(`Failed to create poll: ${(t=n.message)!=null?t:JSON.stringify(n)}`),console.error(n)}finally{p.value=!1}}}async function A(){if(await m.connect(),await m.switchNetwork(K.FromConfig),_.value.length>0)return"";const o={creator:m.address,name:y.value,description:x.value,choices:c.value.map(C=>C.value),options:{publishVotes:g.value}},t=await z("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mb3JtYXRpb24iOnsiaWQiOiI2ZTg3ODViMy05NWJjLTQ2OGMtOTBjMC0wYjk3MzYxMDhhMzYiLCJlbWFpbCI6Im1hdGV2ekBvYXNpc3Byb3RvY29sLm9yZyIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJwaW5fcG9saWN5Ijp7InJlZ2lvbnMiOlt7ImlkIjoiRlJBMSIsImRlc2lyZWRSZXBsaWNhdGlvbkNvdW50IjoxfSx7ImlkIjoiTllDMSIsImRlc2lyZWRSZXBsaWNhdGlvbkNvdW50IjoxfV0sInZlcnNpb24iOjF9LCJtZmFfZW5hYmxlZCI6ZmFsc2UsInN0YXR1cyI6IkFDVElWRSJ9LCJhdXRoZW50aWNhdGlvblR5cGUiOiJzY29wZWRLZXkiLCJzY29wZWRLZXlLZXkiOiI5ODZhNjYzZTAzMzdmMWY1ZDQ0YSIsInNjb3BlZEtleVNlY3JldCI6IjhlZTdlOTY5ZDBlNDk2ZjYxNjczY2MyMTljODM3NTAyNWI5YzI1MWQ5ZjczOGExMmUwYjYzOTQyMmNmNmI0NDIiLCJpYXQiOjE2ODc5NDk3NDZ9.EvPGhWtjXeHMivn9uZQAjU4dSv_-Vs156I8EVKbOIKY",o),n=await t.json();if(t.status!==201)throw new Error(n.error);const r={ipfsHash:n.ipfsHash,numChoices:c.value.length,publishVotes:o.options.publishVotes};let d;(await R).value,(await T).value,console.log("doCreatePoll: Using direct transaction to create proposal");const M=await P.value.createProposal(r);console.log("doCreatePoll: creating proposal tx",M.hash);const O=await M.wait();if(O.status!==1)throw new Error("createProposal tx receipt reported failure.");d=O.logs[0].data,console.log("doCreatePoll: Proposal ID",d);let S=!1;for(;!S;)console.log("doCreatePoll: checking if ballot has been created on Sapphire",d),S=await B.value.callStatic.ballotIsActive(d),await new Promise(C=>setTimeout(C,1e3));return d.replace("0x","")}return(o,t)=>{const n=Q("RouterLink");return I.value?(a(),i("section",Te,[v(le,null,{default:f(()=>[ze,Le,He,v(n,{to:{name:"poll",params:{id:I.value}}},{default:f(()=>[v(V,{variant:"secondary"},{default:f(()=>[Z("View poll")]),_:1})]),_:1},8,["to"])]),_:1})])):(a(),i("section",be,[ye,xe,e("form",{onSubmit:H},[e("div",ge,[b(e("input",{type:"text",id:"question",class:"peer",placeholder:" ","onUpdate:modelValue":t[0]||(t[0]=s=>y.value=s),required:""},null,512),[[k,y.value]]),Ie]),e("div",Ce,[b(e("textarea",{id:"description",class:"peer",placeholder:" ","onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s),rows:"3"},null,512),[[k,x.value]]),ke]),e("div",Ve,[Ne,(a(!0),i(D,null,W(c.value,(s,r)=>(a(),i("div",{class:"relative flex justify-between items-center mb-4 gap-3 px-5",key:s.key},[b(e("input",{class:"focus:outline-none focus:ring-0 pb-2 text-primaryDark",type:"text",id:"name",placeholder:`${r+1}. Answer`,"onUpdate:modelValue":d=>c.value[r].value=d,required:""},null,8,Ze),[[k,c.value[r].value]]),c.value.length>2?(a(),ee(pe,{key:0,class:te(["cursor-pointer absolute right-5 bottom-2",{"cursor-default":p.value}]),disabled:p.value,"data-ix":r,onClick:Y(d=>L(r),["prevent"])},null,8,["class","disabled","data-ix","onClick"])):J("",!0)]))),128)),v(V,{class:"ml-5",size:"small",variant:"tertiary",disabled:p.value,onClick:Y(w,["prevent"])},{default:f(()=>[e("span",je,[v(we),Me])]),_:1},8,["disabled","onClick"])]),e("div",Oe,[Se,e("div",De,[b(e("input",{id:"publish-votes",class:"w-5 h-5 border-2 border-gray-500",type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=s=>g.value=s)},null,512),[[q,g.value]]),We])]),v(V,{type:"submit",variant:"primary",disabled:p.value},{default:f(()=>[p.value?(a(),i("span",Ye,"Creating\u2026")):(a(),i("span",Je,"Create Poll"))]),_:1},8,["disabled"]),_.value.length>0?(a(),i("div",Pe,[Be,e("ul",Re,[(a(!0),i(D,null,W(_.value,s=>(a(),i("li",{key:s},se(s),1))),128))])])):J("",!0)],32)]))}}});const Ge=N(Ae,[["__scopeId","data-v-44ab7cc5"]]);export{Ge as default};
//# sourceMappingURL=CreatePollView.10eb1bfd.js.map
