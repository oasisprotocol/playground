import{_ as S,o as a,c as i,a as e,d as Z,u as z,b as R,e as G,f as Q,g as Y,r as u,h as K,w as g,v as k,F as B,i as D,j as v,k as w,l as M,A as P,m as W,n as O,N as X,p as ee,q as te,t as se,s as H,x as oe,y as ae}from"./index.8571c2e6.js";import{S as le}from"./SuccessInfo.2b3bf7c5.js";const ne={},ie={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},re=e("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM17 13H7V11H17V13Z",fill:"#565B61"},null,-1),ce=[re];function de(h,f){return a(),i("svg",ie,ce)}const pe=S(ne,[["render",de]]),ue={},he={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},_e=e("g",{"clip-path":"url(#clip0_56_1176)"},[e("path",{d:"M13 7H11V11H7V13H11V17H13V13H17V11H13V7ZM12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z",fill:"currentColor"})],-1),ve=e("defs",null,[e("clipPath",{id:"clip0_56_1176"},[e("rect",{width:"24",height:"24",fill:"white"})])],-1),fe=[_e,ve];function we(h,f){return a(),i("svg",he,fe)}const me=S(ue,[["render",we]]),l=h=>(oe("data-v-44ab7cc5"),h=h(),ae(),h),ge={key:0},be=l(()=>e("h2",{class:"capitalize text-white text-2xl font-bold mb-4"},"New pool",-1)),xe=l(()=>e("p",{class:"text-white text-base mb-20"}," Create your new poll by filling out the fields below. Once created, your poll will be live immediately and responses will start being recorded. ",-1)),ye={class:"form-group"},Ce=l(()=>e("label",{for:"question",class:"peer-focus:text-primaryDark peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-5"},[H(" Question "),e("span",{class:"text-red-500"},"*")],-1)),Ve={class:"form-group"},ke=l(()=>e("label",{for:"description",class:"peer-focus:text-primaryDark peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-5"}," Description ",-1)),Pe={class:"form-group-answers"},Se=l(()=>e("label",{class:"inline-block mb-5"},[H("Answers "),e("span",{class:"text-red-500"},"*")],-1)),He=["placeholder","onUpdate:modelValue"],$e={class:"flex gap-2"},Ie=l(()=>e("span",{class:"leading-6"},"Add answer",-1)),Ne={class:"form-group-answers"},Ae=l(()=>e("label",{class:"inline-block mb-5"},"Additional options",-1)),Be={class:"flex pl-4"},De=l(()=>e("label",{class:"ml-3 text-base text-gray-900",for:"publish-votes"}," Publish individual votes after voting has ended. ",-1)),Me={key:0},Oe={key:1},Ue={key:0,class:"text-red-500 px-3 mt-5 rounded-xl-sm"},Ee=l(()=>e("span",{class:"font-bold"},"Errors:",-1)),Te={class:"list-disc px-8"},je={key:1},Fe=l(()=>e("h3",{class:"text-white text-3xl mb-4"},"Success",-1)),qe=l(()=>e("p",{class:"text-white text-base"},"Your poll is live.",-1)),Je=l(()=>e("p",{class:"text-white text-base mb-24"},"Votes will be recorded from now on.",-1)),Le=Z({__name:"CreatePollView",setup(h){const f=z(),U=R(),E=G(),T=Q(),j=Y(),F=async(o,t)=>{const n=await fetch("https://api.pinata.cloud/pinning/pinJSONToIPFS",{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${o}`},body:JSON.stringify({pinataContent:t})}),s=await n.json();if(n.status!==200)throw new Error("failed to pin");const r={ipfsHash:s.IpfsHash};return new Response(JSON.stringify(r),{status:201,headers:{"content-type":"application/json"}})},_=u([]),b=u(""),x=u(""),c=u([]),y=u(!1),p=u(!1),C=u("");let $=0;const q=o=>c.value.splice(o,1),m=()=>{c.value.push({key:$,value:""}),$++};m(),m(),m();async function J(o){var t;if(!(o.target instanceof HTMLFormElement&&(o.target.checkValidity(),!o.target.reportValidity()))){o.preventDefault();try{_.value.splice(0,_.value.length),p.value=!0,C.value=await L()}catch(n){_.value.push(`Failed to create poll: ${(t=n.message)!=null?t:JSON.stringify(n)}`),console.error(n)}finally{p.value=!1}}}async function L(){if(await f.connect(),await f.switchNetwork(X.FromConfig),_.value.length>0)return"";const o={creator:f.address,name:b.value,description:x.value,choices:c.value.map(V=>V.value),options:{publishVotes:y.value}},t=await F("",o),n=await t.json();if(t.status!==201)throw new Error(n.error);const r={ipfsHash:n.ipfsHash,numChoices:c.value.length,publishVotes:o.options.publishVotes};let d;(await T).value,(await j).value,console.log("doCreatePoll: Using direct transaction to create proposal");const I=await U.value.createProposal(r);console.log("doCreatePoll: creating proposal tx",I.hash);const N=await I.wait();if(N.status!==1)throw new Error("createProposal tx receipt reported failure.");d=N.logs[0].data,console.log("doCreatePoll: Proposal ID",d);let A=!1;for(;!A;)console.log("doCreatePoll: checking if ballot has been created on Sapphire",d),A=await E.value.callStatic.ballotIsActive(d),await new Promise(V=>setTimeout(V,1e3));return d.replace("0x","")}return(o,t)=>{const n=K("RouterLink");return C.value?(a(),i("section",je,[v(le,null,{default:w(()=>[Fe,qe,Je,v(n,{to:{name:"poll",params:{id:C.value}}},{default:w(()=>[v(P,{variant:"secondary"},{default:w(()=>[H("View poll")]),_:1})]),_:1},8,["to"])]),_:1})])):(a(),i("section",ge,[be,xe,e("form",{onSubmit:J},[e("div",ye,[g(e("input",{type:"text",id:"question",class:"peer",placeholder:" ","onUpdate:modelValue":t[0]||(t[0]=s=>b.value=s),required:""},null,512),[[k,b.value]]),Ce]),e("div",Ve,[g(e("textarea",{id:"description",class:"peer",placeholder:" ","onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s),rows:"3"},null,512),[[k,x.value]]),ke]),e("div",Pe,[Se,(a(!0),i(B,null,D(c.value,(s,r)=>(a(),i("div",{class:"relative flex justify-between items-center mb-4 gap-3 px-5",key:s.key},[g(e("input",{class:"focus:outline-none focus:ring-0 pb-2 text-primaryDark",type:"text",id:"name",placeholder:`${r+1}. Answer`,"onUpdate:modelValue":d=>c.value[r].value=d,required:""},null,8,He),[[k,c.value[r].value]]),c.value.length>2?(a(),ee(pe,{key:0,class:te(["cursor-pointer absolute right-5 bottom-2",{"cursor-default":p.value}]),disabled:p.value,"data-ix":r,onClick:M(d=>q(r),["prevent"])},null,8,["class","disabled","data-ix","onClick"])):O("",!0)]))),128)),v(P,{class:"ml-5",size:"small",variant:"tertiary",disabled:p.value,onClick:M(m,["prevent"])},{default:w(()=>[e("span",$e,[v(me),Ie])]),_:1},8,["disabled","onClick"])]),e("div",Ne,[Ae,e("div",Be,[g(e("input",{id:"publish-votes",class:"w-5 h-5 border-2 border-gray-500",type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=s=>y.value=s)},null,512),[[W,y.value]]),De])]),v(P,{type:"submit",variant:"primary",disabled:p.value},{default:w(()=>[p.value?(a(),i("span",Me,"Creating\u2026")):(a(),i("span",Oe,"Create Poll"))]),_:1},8,["disabled"]),_.value.length>0?(a(),i("div",Ue,[Ee,e("ul",Te,[(a(!0),i(B,null,D(_.value,s=>(a(),i("li",{key:s},se(s),1))),128))])])):O("",!0)],32)]))}}});const Re=S(Le,[["__scopeId","data-v-44ab7cc5"]]);export{Re as default};
//# sourceMappingURL=CreatePollView.3fd7ecf8.js.map
