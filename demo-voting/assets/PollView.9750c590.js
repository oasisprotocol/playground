import{d as Z,o as e,c as a,B as ae,s as J,_ as N,a as t,q as C,l as r,C as K,D as oe,b as le,e as ie,u as ne,f as ce,g as re,r as n,E as O,h as ue,N as U,G as de,H as ve,i as pe,t as w,k as g,A as $,p as c,F as q,j as H,I as _e,x as S,J as he,y as fe,z as we}from"./index.139a715d.js";import{S as Y}from"./SuccessInfo.8d5aeb3e.js";const ge=Z({__name:"AppBadge",props:{variant:{}},setup(_){return(x,u)=>(e(),a("span",{class:J(["badge",{"badge-active":x.variant==="active","badge-closed":x.variant==="closed"}])},[ae(x.$slots,"default",{},void 0,!0)],2))}});const me=N(ge,[["__scopeId","data-v-02503d7b"]]),xe={},ye={width:"24",height:"25",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg"},be=t("g",{"clip-path":"url(#clip0_56_971)"},[t("path",{d:"M12 7.1333C9.24 7.1333 7 9.3733 7 12.1333C7 14.8933 9.24 17.1333 12 17.1333C14.76 17.1333 17 14.8933 17 12.1333C17 9.3733 14.76 7.1333 12 7.1333ZM12 2.1333C6.48 2.1333 2 6.6133 2 12.1333C2 17.6533 6.48 22.1333 12 22.1333C17.52 22.1333 22 17.6533 22 12.1333C22 6.6133 17.52 2.1333 12 2.1333ZM12 20.1333C7.58 20.1333 4 16.5533 4 12.1333C4 7.7133 7.58 4.1333 12 4.1333C16.42 4.1333 20 7.7133 20 12.1333C20 16.5533 16.42 20.1333 12 20.1333Z",fill:"currentColor"})],-1),Ce=t("defs",null,[t("clipPath",{id:"clip0_56_971"},[t("rect",{width:"24",height:"24",fill:"white",transform:"translate(0 0.133301)"})])],-1),ke=[be,Ce];function Ve(_,x){return e(),a("svg",ye,ke)}const Pe=N(xe,[["render",Ve]]),$e={},Se={width:"24",height:"25",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ae=t("g",{"clip-path":"url(#clip0_56_273)"},[t("path",{d:"M12 2.1333C6.48 2.1333 2 6.6133 2 12.1333C2 17.6533 6.48 22.1333 12 22.1333C17.52 22.1333 22 17.6533 22 12.1333C22 6.6133 17.52 2.1333 12 2.1333ZM12 20.1333C7.58 20.1333 4 16.5533 4 12.1333C4 7.7133 7.58 4.1333 12 4.1333C16.42 4.1333 20 7.7133 20 12.1333C20 16.5533 16.42 20.1333 12 20.1333Z",fill:"currentColor"})],-1),Be=t("defs",null,[t("clipPath",{id:"clip0_56_273"},[t("rect",{width:"24",height:"24",fill:"white",transform:"translate(0 0.133301)"})])],-1),Ie=[Ae,Be];function Ne(_,x){return e(),a("svg",Se,Ie)}const De=N($e,[["render",Ne]]),Ee=t("rect",{x:"5",y:"10",rx:"3",ry:"3",width:"361",height:"28"},null,-1),Ge=t("rect",{x:"5",y:"26",rx:"3",ry:"3",width:"52",height:"6"},null,-1),Le=t("rect",{x:"5",y:"61",rx:"3",ry:"3",width:"410",height:"16"},null,-1),Me=t("rect",{x:"680",y:"10",rx:"0",ry:"0",width:"80",height:"19"},null,-1),Te=Z({__name:"PollDetailsLoader",setup(_){return(x,u)=>(e(),C(K(oe),{viewBox:"0 0 768 124",speed:2,primaryColor:"white",secondaryColor:"#e3e3e3"},{default:r(()=>[Ee,Ge,Le,Me]),_:1}))}}),D=_=>(fe("data-v-2c2bf594"),_=_(),we(),_),Ze={key:0},Fe={key:0},Re={class:"flex justify-between items-center mb-4"},je={class:"capitalize text-white text-2xl font-bold"},ze={class:"text-white text-base mb-20"},Oe={key:0,class:"flex justify-end mb-6"},Ue={key:1,class:"text-white text-base mb-10"},qe={key:0},He={class:"flex gap-2"},Ye={class:"leading-6"},Je={key:2,class:"leading-6"},Ke={key:1,class:"text-white text-base mt-10"},Qe={key:2,class:"capitalize text-white text-2xl font-bold mt-10"},We=D(()=>t("label",{class:"inline-block mb-5"},"Individual votes",-1)),Xe={key:0},et={key:1},tt={key:4,class:"error mt-2 text-center"},st={class:"font-bold"},at={key:1},ot=D(()=>t("h3",{class:"text-white text-3xl mb-4"},"Thank you",-1)),lt=D(()=>t("p",{class:"text-white text-center text-base mb-4"},"Your vote has been recorded.",-1)),it={class:"flex gap-2"},nt={key:1,class:"text-white text-center text-base mb-24"},ct={key:2},rt=D(()=>t("p",{class:"text-white text-base mb-4"},"The poll has been closed.",-1)),ut=Z({__name:"PollView",props:{id:{}},setup(_){const u=`0x${_.id}`,A=le(),B=ie(),v=ne(),Q=ce(),W=re(),I=n(""),k=n(!1),E=n(!1),G=n(!1),s=n(),y=n(void 0),h=n(),L=n(void 0),F=n([]),M=n([[],[]]);let R=n(!1),j=n(!1);const X=O(()=>!v.address||y.value!==void 0||h.value===void 0||L.value!==void 0?!1:j.value!=!1),ee=O(()=>y.value!==void 0?!1:v.address===void 0?!0:L.value===void 0);async function te(){if((await(await A.value.closeProposal(u)).wait()).status!=1)throw new Error("close ballot tx failed");G.value=!0}async function z(f){var i;f.preventDefault();try{I.value="",k.value=!0,await se(),E.value=!0}catch(p){I.value=(i=p.reason)!=null?i:p.message}finally{k.value=!1}}async function se(){if(h.value===void 0)throw new Error("no choice selected");const f=h.value,i=(await Q).value,p=(await W).value;if(i&&p){if(console.log("doVote: using gasless voting"),!v.signer)throw new Error("No signer!");const d={voter:await i.signer.getAddress(),proposalId:u,choiceId:f},V=await v.signer._signTypedData({name:"DAOv1.GaslessVoting",version:"1",chainId:"0x5aff",verifyingContract:i.address},{VotingRequest:[{name:"voter",type:"address"},{name:"proposalId",type:"bytes32"},{name:"choiceId",type:"uint256"}]},d),P=_e(V),m=await B.value.provider.getGasPrice();console.log("doVote.gasless: constructing tx","gasPrice",m);const b=await i.makeVoteTransaction(m,d,P);let l=await v.unwrappedProvider.sendTransaction(b);if(console.log("doVote.gasless: waiting for tx",l.hash),(await p.provider.waitForTransaction(l.hash)).status!=1)throw new Error("cast vote tx failed");console.log("doVote.gasless: success")}else if(console.log("doVote: casting vote using normal tx"),await v.switchNetwork(U.FromConfig),(await(await A.value.castVote(u,f)).wait()).status!=1)throw new Error("cast vote tx failed");L.value=f}return ue(async()=>{await v.connect(),await v.switchNetwork(U.FromConfig);const[f,i,p]=await B.value.callStatic.proposals(u),d={id:u,active:f,topChoice:p,params:i},P=await(await fetch(`https://w3s.link/ipfs/${i.ipfsHash}`)).json();s.value={proposal:d,ipfsParams:P},d.active||(F.value=await B.value.callStatic.getVoteCounts(u),h.value=y.value=d.topChoice,d.params.publishVotes&&(M.value=await B.value.callStatic.getVotes(u)));const m=await de(),b=v.signer?await v.signer.getAddress():ve;await Promise.all([m.value.callStatic.canManagePoll(A.value.address,u,b).then(l=>{R.value=l}),m.value.callStatic.canVoteOnPoll(A.value.address,u,b).then(l=>{j.value=l})])}),(f,i)=>{var d,V,P,m,b;const p=pe("RouterLink");return!E.value&&!G.value?(e(),a("section",Ze,[s.value?(e(),a("div",Fe,[t("div",Re,[t("h2",je,w(s.value.ipfsParams.name),1),g(me,{variant:s.value.proposal.active?"active":"closed"},{default:r(()=>[S(w(s.value.proposal.active?"Active":"Closed"),1)]),_:1},8,["variant"])]),t("p",ze,w(s.value.ipfsParams.description),1),s.value.proposal.active&&K(R)?(e(),a("div",Oe,[g($,{variant:"secondary",onClick:te},{default:r(()=>[S("Close poll")]),_:1})])):c("",!0),s.value.proposal.active?(e(),a("p",Ue," Please choose your answer below: ")):c("",!0),t("form",{onSubmit:z},[(d=s.value)!=null&&d.ipfsParams.choices?(e(),a("div",qe,[(e(!0),a(q,null,H(s.value.ipfsParams.choices,(l,o)=>(e(),C($,{key:o,class:J([{selected:h.value===o||o===y.value,"pointer-events-none":k.value||!s.value.proposal.active},"choice-btn mb-2 w-full"]),variant:"choice",onClick:T=>h.value=o,disabled:!ee.value&&y.value!==void 0&&o!==y.value},{default:r(()=>[t("span",He,[h.value===o||o===y.value?(e(),C(Pe,{key:0})):(e(),C(De,{key:1})),t("span",Ye,w(l),1),s.value.proposal.active?c("",!0):(e(),a("span",Je,"("+w(F.value[o])+")",1))])]),_:2},1032,["class","onClick","disabled"]))),128))])):c("",!0),((V=s.value)==null?void 0:V.ipfsParams.options.publishVotes)&&s.value.proposal.active?(e(),a("p",Ke," Votes will be made public after voting has ended. ")):c("",!0),((P=s.value)==null?void 0:P.ipfsParams.options.publishVotes)&&!s.value.proposal.active?(e(),a("div",Qe,[We,(e(!0),a(q,null,H(M.value[0],(l,o)=>(e(),a("p",{key:o,class:"text-white text-base",variant:"addr"},w(l)+": "+w(s.value.ipfsParams.choices[M.value[1][o]]),1))),128))])):c("",!0),(b=(m=s.value)==null?void 0:m.proposal)!=null&&b.active?(e(),C($,{key:3,type:"submit",variant:"primary",class:"mt-14",disabled:!X.value||k.value,onClick:z},{default:r(()=>[k.value?(e(),a("span",Xe,"Submitting Vote\u2026")):k.value?c("",!0):(e(),a("span",et,"Submit vote"))]),_:1},8,["disabled"])):c("",!0),I.value?(e(),a("p",tt,[t("span",st,w(I.value),1)])):c("",!0)],32)])):(e(),C(Te,{key:1}))])):E.value?(e(),a("section",at,[g(Y,null,{default:r(()=>{var l,o,T;return[ot,lt,((o=(l=s.value)==null?void 0:l.ipfsParams)==null?void 0:o.choices)&&h.value?(e(),C($,{key:0,class:"mb-4 pointer-events-none cursor-not-allowed w-full voted",variant:"choice"},{default:r(()=>[t("span",it,[g(he,{class:"w-7"}),S(" "+w(s.value.ipfsParams.choices[h.value]),1)])]),_:1})):c("",!0),(T=s.value)!=null&&T.ipfsParams.options.publishVotes?(e(),a("p",nt," Your vote will be published after voting has ended. ")):c("",!0),g(p,{to:"/"},{default:r(()=>[g($,{variant:"secondary"},{default:r(()=>[S("Go to overview")]),_:1})]),_:1})]}),_:1})])):G.value?(e(),a("section",ct,[g(Y,null,{default:r(()=>[rt,g(p,{to:"/"},{default:r(()=>[g($,{variant:"secondary"},{default:r(()=>[S("Go to overview")]),_:1})]),_:1})]),_:1})])):c("",!0)}}});const pt=N(ut,[["__scopeId","data-v-2c2bf594"]]);export{pt as default};
//# sourceMappingURL=PollView.9750c590.js.map
